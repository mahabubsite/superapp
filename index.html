<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super App - All-in-One Toolbox</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <!-- PDF & QR/Barcode Libraries -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query, orderBy, doc, getDoc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
        
        window.firebase = {
            initializeApp, getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup,
            getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query, orderBy, doc, getDoc, deleteDoc, updateDoc
        };
    </script>
    <style>
        :root.light { --bg-primary: #f3f4f6; --bg-secondary: #ffffff; --text-primary: #111827; --text-secondary: #6b7280; --border-color: #e5e7eb; --accent-color: #3b82f6; --accent-color-hover: #2563eb; }
        :root.dark { --bg-primary: #111827; --bg-secondary: #1f2937; --text-primary: #f9fafb; --text-secondary: #9ca3af; --border-color: #374151; --accent-color: #60a5fa; --accent-color-hover: #3b82f6; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-primary); color: var(--text-primary); }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .input-field, .select-field { background-color: var(--bg-primary); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 0.5rem; padding: 0.5rem 0.75rem; }
        .btn-primary { background-color: var(--accent-color); color: white; border-radius: 0.5rem; padding: 0.6rem 1rem; font-weight: 600; }
        .btn-primary:hover { background-color: var(--accent-color-hover); }
        .btn-secondary { background-color: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 0.5rem; padding: 0.6rem 1rem; font-weight: 600; }
        #image-editor-canvas-container { position: relative; width: 100%; height: 400px; }
        #image-editor-canvas, #image-editor-drawing-canvas { position: absolute; top: 0; left: 0; }
        .filter-btn:hover { background-color: var(--accent-color); color: white; }
        .app-modal-overlay { background-color: rgba(0, 0, 0, 0.2); backdrop-filter: blur(8px); }
        .app-modal-content { background-color: var(--bg-secondary); border: 1px solid var(--border-color); }
        #compass-dial { transition: transform 0.5s ease-out; border: 5px solid var(--text-primary); }
    </style>
</head>
<body class="antialiased">

    <!-- Auth Container -->
    <div id="auth-container" class="fixed inset-0 z-50 flex items-center justify-center hidden p-4 bg-gray-900 bg-opacity-60">
        <div class="w-full max-w-md p-8 space-y-6 bg-[var(--bg-secondary)] rounded-2xl shadow-xl relative">
            <button id="auth-close-btn" class="absolute top-4 right-4 p-2 rounded-full hover:bg-[var(--bg-primary)]"><i data-lucide="x"></i></button>
            <div><h2 id="auth-title" class="text-center text-3xl font-extrabold">Sign In</h2></div>
            <button id="google-signin-btn" class="w-full flex items-center justify-center gap-3 py-2.5 border border-[var(--border-color)] rounded-lg hover:bg-[var(--bg-primary)] transition-colors">
                <svg class="w-5 h-5" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C39.712,34.464,44,28.756,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                <span>Continue with Google</span>
            </button>
            <div class="relative"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-[var(--border-color)]"></div></div><div class="relative flex justify-center text-sm"><span class="px-2 bg-[var(--bg-secondary)] text-[var(--text-secondary)]">Or</span></div></div>
            <form id="auth-form" class="space-y-6">
                <input id="auth-email" type="email" autocomplete="email" required class="input-field w-full" placeholder="Email address">
                <input id="auth-password" type="password" autocomplete="current-password" required class="input-field w-full" placeholder="Password">
                <p id="auth-error" class="text-red-500 text-sm hidden"></p>
                <button type="submit" id="auth-submit-btn" class="btn-primary w-full">Sign In</button>
            </form>
            <p class="text-center text-sm"><a href="#" id="auth-toggle-link" class="font-medium text-[var(--accent-color)] hover:text-[var(--accent-color-hover)]">Don't have an account? Sign Up</a></p>
        </div>
    </div>

    <!-- App Container -->
    <div id="app-container" class="min-h-screen">
        <header class="bg-[var(--bg-secondary)] border-b border-[var(--border-color)] sticky top-0 z-20 shadow-sm"><div class="container mx-auto px-4 sm:px-6 lg:px-8"><div class="flex items-center justify-between h-16"><div class="flex items-center space-x-4"><i data-lucide="layout-grid" class="h-7 w-7 text-[var(--accent-color)]"></i><h1 class="text-xl font-bold">Super App</h1></div><div class="flex items-center space-x-2"><button id="theme-toggle" class="p-2 rounded-full hover:bg-[var(--bg-primary)]"><i data-lucide="sun" id="theme-icon-sun" class="h-5 w-5"></i><i data-lucide="moon" id="theme-icon-moon" class="h-5 w-5 hidden"></i></button>
            <div id="user-menu-container" class="relative hidden">
                <button id="user-menu-button" class="p-2 rounded-full hover:bg-[var(--bg-primary)]"><i data-lucide="more-vertical" class="h-5 w-5"></i></button>
                <div id="user-menu-dropdown" class="absolute right-0 mt-2 w-56 origin-top-right bg-[var(--bg-secondary)] rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none hidden" role="menu">
                    <div class="py-1" role="none">
                        <div class="px-4 py-3 border-b border-[var(--border-color)]"><p class="text-sm font-semibold text-[var(--text-primary)]">Signed in as</p><p id="user-email-dropdown" class="text-sm truncate text-[var(--text-secondary)]"></p></div>
                        <div class="py-1"><a href="#" id="logout-btn-dropdown" class="flex items-center gap-2 px-4 py-2 text-sm text-red-500 hover:bg-[var(--bg-primary)]" role="menuitem"><i data-lucide="log-out" class="h-4 w-4"></i>Logout</a></div>
                    </div>
                </div>
            </div>
            <button id="login-btn" class="btn-primary text-sm">Login</button>
        </div></div></div></header>
        <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-extrabold tracking-tight">Your All-in-One Digital Toolbox</h2><p class="mt-4 max-w-2xl mx-auto text-lg text-[var(--text-secondary)]">One login, countless tools. Find everything you need right here.</p></div>
            <div class="search-bar sticky top-16 z-10 p-4 rounded-lg mb-8 bg-[var(--bg-secondary)] border border-[var(--border-color)]"><div class="flex flex-col md:flex-row gap-4"><div class="relative flex-grow"><i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-[var(--text-secondary)]"></i><input type="text" id="search-input" placeholder="Search for a tool..." class="input-field w-full pl-10 pr-4 py-2 focus:ring-2 focus:ring-[var(--accent-color)] focus:outline-none"></div><div id="filter-buttons" class="flex-shrink-0 flex flex-wrap gap-2 items-center"></div></div></div>
            <div id="features-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6"></div>
            <div id="no-results" class="text-center py-16 hidden"><i data-lucide="folder-search" class="h-16 w-16 mx-auto text-[var(--text-secondary)]"></i><h3 class="mt-4 text-xl font-semibold">No Tools Found</h3><p class="mt-2 text-[var(--text-secondary)]">Try adjusting your search or filter.</p></div>
        </main>
        <div id="app-modal" class="app-modal-overlay fixed inset-0 z-30 flex items-center justify-center p-4 hidden"><div class="app-modal-content w-full max-w-4xl max-h-[90vh] rounded-xl shadow-2xl flex flex-col"><header class="flex items-center justify-between p-4 border-b border-[var(--border-color)] flex-shrink-0"><h3 id="app-modal-title" class="text-lg font-semibold"></h3><button id="app-modal-close" class="p-1 rounded-full hover:bg-[var(--bg-primary)]"><i data-lucide="x" class="h-5 w-5"></i></button></header><main id="app-modal-body" class="p-6 overflow-y-auto"></main></div></div>
    </div>

    <script type="module">
        // --- FIREBASE SETUP ---
        const { initializeApp, getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup, getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query, orderBy, doc, getDoc, deleteDoc, updateDoc } = window.firebase;
        const firebaseConfig = { apiKey: "AIzaSyBRnZI0vKKz69Aj7Ns2zXFgKsbp8mQltRw", authDomain: "super-app-8703e.firebaseapp.com", projectId: "super-app-8703e", storageBucket: "super-app-8703e.appspot.com", messagingSenderId: "201923869092", appId: "1:201923869092:web:9de078705b4a53f363e931" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // --- GLOBAL STATE ---
        let currentUserId = null;
        let unsubscribeNotes = null;
        let unsubscribeTasks = null;

        // --- GLOBAL ELEMENTS & AUTH LOGIC ---
        const authContainer = document.getElementById('auth-container'), loginBtn = document.getElementById('login-btn'), authForm = document.getElementById('auth-form'), authTitle = document.getElementById('auth-title'), authSubmitBtn = document.getElementById('auth-submit-btn'), authToggleLink = document.getElementById('auth-toggle-link'), authErrorEl = document.getElementById('auth-error'), authEmailInput = document.getElementById('auth-email'), authPasswordInput = document.getElementById('auth-password'), googleSignInBtn = document.getElementById('google-signin-btn'), authCloseBtn = document.getElementById('auth-close-btn');
        const userMenuContainer = document.getElementById('user-menu-container'), userMenuButton = document.getElementById('user-menu-button'), userMenuDropdown = document.getElementById('user-menu-dropdown'), userEmailDropdown = document.getElementById('user-email-dropdown'), logoutBtnDropdown = document.getElementById('logout-btn-dropdown');
        let isLoginMode = true;

        const showAuthError = msg => { authErrorEl.textContent = msg; authErrorEl.classList.remove('hidden'); };
        const toggleAuthMode = () => { isLoginMode = !isLoginMode; authTitle.textContent = isLoginMode ? 'Sign In' : 'Sign Up'; authSubmitBtn.textContent = isLoginMode ? 'Sign In' : 'Sign Up'; authToggleLink.innerHTML = isLoginMode ? "Don't have an account? Sign Up" : "Already have an account? Sign In"; authErrorEl.classList.add('hidden'); authForm.reset(); };
        
        authToggleLink.onclick = e => { e.preventDefault(); toggleAuthMode(); };
        loginBtn.onclick = () => authContainer.classList.remove('hidden');
        authCloseBtn.onclick = () => authContainer.classList.add('hidden');
        logoutBtnDropdown.onclick = e => { e.preventDefault(); signOut(auth).catch(err => console.error("Logout Error:", err)); };
        googleSignInBtn.onclick = () => signInWithPopup(auth, googleProvider).catch(err => showAuthError(err.message));
        authForm.onsubmit = e => { e.preventDefault(); const email = authEmailInput.value, password = authPasswordInput.value; authErrorEl.classList.add('hidden'); (isLoginMode ? signInWithEmailAndPassword : createUserWithEmailAndPassword)(auth, email, password).catch(err => showAuthError(err.message)); };

        onAuthStateChanged(auth, user => {
            if (user) {
                currentUserId = user.uid;
                authContainer.classList.add('hidden');
                userMenuContainer.classList.remove('hidden');
                loginBtn.classList.add('hidden');
                userEmailDropdown.textContent = user.displayName || user.email;
            } else {
                currentUserId = null;
                if (unsubscribeNotes) unsubscribeNotes();
                if (unsubscribeTasks) unsubscribeTasks();
                userMenuContainer.classList.add('hidden');
                userMenuDropdown.classList.add('hidden');
                loginBtn.classList.remove('hidden');
            }
        });

        userMenuButton.onclick = (e) => { e.stopPropagation(); userMenuDropdown.classList.toggle('hidden'); };
        window.onclick = (e) => { if (!userMenuContainer.contains(e.target)) userMenuDropdown.classList.add('hidden'); };

        // --- THEME & CORE APP LOGIC ---
        const appModal = document.getElementById('app-modal'), appModalTitle = document.getElementById('app-modal-title'), appModalBody = document.getElementById('app-modal-body'), appModalClose = document.getElementById('app-modal-close'), themeToggle = document.getElementById('theme-toggle'), sunIcon = document.getElementById('theme-icon-sun'), moonIcon = document.getElementById('theme-icon-moon');
        const applyTheme = t => { document.documentElement.className = t; sunIcon.classList.toggle('hidden', t === 'dark'); moonIcon.classList.toggle('hidden', t === 'light'); };
        applyTheme(localStorage.getItem('theme') || 'light');
        themeToggle.onclick = () => { const t = document.documentElement.classList.contains('dark') ? 'light' : 'dark'; localStorage.setItem('theme', t); applyTheme(t); };
        
        // --- APP MODAL LOGIC ---
        let currentAppCleanup = null;
        function openApp(feature) {
            if (currentAppCleanup) currentAppCleanup();
            appModalTitle.textContent = feature.name;
            appModalBody.innerHTML = `<div class="flex justify-center items-center p-16"><i data-lucide="loader-circle" class="animate-spin h-10 w-10"></i></div>`;
            lucide.createIcons();
            const renderer = appRenderers[feature.id];
            if (renderer) currentAppCleanup = renderer(appModalBody);
            else appModalBody.innerHTML = `<div class="text-center p-8"><i data-lucide="construct" class="h-12 w-12 mx-auto text-[var(--text-secondary)]"></i><h4 class="mt-4 font-semibold">Error</h4><p class="text-[var(--text-secondary)] mt-1">This tool could not be loaded.</p></div>`;
            lucide.createIcons();
            appModal.classList.remove('hidden');
        }
        function closeApp() { if (currentAppCleanup) { currentAppCleanup(); currentAppCleanup = null; } appModal.classList.add('hidden'); }
        appModalClose.onclick = closeApp;
        appModal.onclick = e => { if (e.target === appModal) closeApp(); };

        // --- APP IMPLEMENTATIONS ---
        const appRenderers = {
            notepad: (container) => {
                if (!currentUserId) { container.innerHTML = `<p class="text-center">Please log in to use the notepad.</p>`; return; }
                container.innerHTML = `<div class="space-y-4"><form id="n-form" class="flex gap-2"><input type="text" id="n-input" class="input-field flex-grow" placeholder="New note title..." required><button type="submit" class="btn-primary">Add Note</button></form><div id="n-list" class="space-y-2"></div></div>`;
                const form = document.getElementById("n-form"), input = document.getElementById("n-input"), listEl = document.getElementById("n-list");
                const notesRef = collection(db, "users", currentUserId, "notes");
                
                unsubscribeNotes = onSnapshot(query(notesRef, orderBy("createdAt", "desc")), snapshot => {
                    const sortedDocs = snapshot.docs.sort((a, b) => (b.data().pinned || false) - (a.data().pinned || false));
                    
                    listEl.innerHTML = snapshot.empty ? `<p class="text-center text-[var(--text-secondary)] p-4">No notes yet.</p>` : sortedDocs.map(doc => {
                        const note = doc.data();
                        return `<details class="p-3 rounded-lg bg-[var(--bg-primary)]"><summary class="flex items-center cursor-pointer">${note.pinned ? '<i data-lucide="pin" class="h-4 w-4 text-[var(--accent-color)] mr-2"></i>' : ''}<span class="font-semibold">${note.title}</span><div class="ml-auto flex gap-2"><button data-id="${doc.id}" class="pin-note p-1"><i data-lucide="pin" class="h-4 w-4"></i></button><button data-id="${doc.id}" class="delete-note p-1"><i data-lucide="trash-2" class="h-4 w-4"></i></button></div></summary><textarea data-id="${doc.id}" class="w-full h-48 p-2 mt-2 input-field">${note.content}</textarea></details>`;
                    }).join("");
                    lucide.createIcons();
                });

                form.onsubmit = async e => { e.preventDefault(); if (input.value.trim()) { await addDoc(notesRef, { title: input.value.trim(), content: "", pinned: false, createdAt: serverTimestamp() }); input.value = ""; } };
                listEl.oninput = async e => { if (e.target.tagName === "TEXTAREA") { const noteRef = doc(db, "users", currentUserId, "notes", e.target.dataset.id); await updateDoc(noteRef, { content: e.target.value }); } };
                listEl.onclick = async e => { const id = e.target.closest("button")?.dataset.id; if (id) { const noteRef = doc(db, "users", currentUserId, "notes", id); if (e.target.closest(".delete-note")) { await deleteDoc(noteRef); } else if (e.target.closest(".pin-note")) { const noteDoc = await getDoc(noteRef); await updateDoc(noteRef, { pinned: !noteDoc.data().pinned }); } } };
                return () => { if (unsubscribeNotes) unsubscribeNotes(); };
            },
            todo: (container) => {
                if (!currentUserId) { container.innerHTML = `<p class="text-center">Please log in to use the to-do list.</p>`; return; }
                container.innerHTML = `<div class="space-y-4"><form id="t-form" class="grid grid-cols-1 md:grid-cols-3 gap-2"><input type="text" id="t-input" class="input-field md:col-span-2" placeholder="Add task..." required><div class="flex gap-2"><input type="date" id="t-date" class="input-field w-full"><input type="time" id="t-time" class="input-field w-full"></div><button type="submit" class="btn-primary md:col-span-3">Add Task</button></form><ul id="t-list" class="space-y-2"></ul></div>`;
                const form = document.getElementById("t-form"), input = document.getElementById("t-input"), dateInput = document.getElementById("t-date"), timeInput = document.getElementById("t-time"), listEl = document.getElementById("t-list");
                const tasksRef = collection(db, "users", currentUserId, "tasks");

                unsubscribeTasks = onSnapshot(query(tasksRef, orderBy("createdAt", "desc")), snapshot => {
                    listEl.innerHTML = snapshot.empty ? `<li class="text-center text-[var(--text-secondary)] p-4">Empty!</li>` : snapshot.docs.map(doc => {
                        const task = doc.data();
                        return `<li class="todo-item flex items-center p-3 rounded-lg bg-[var(--bg-primary)] ${task.completed ? "completed" : ""}" data-id="${doc.id}"><input type="checkbox" ${task.completed ? "checked" : ""} class="h-5 w-5 rounded text-[var(--accent-color)] mr-3 cursor-pointer"><div class="flex-grow"><span class="${task.completed ? 'line-through' : ''}">${task.text}</span>${task.date ? `<p class="text-xs text-[var(--text-secondary)]">${new Date(task.date).toLocaleDateString()} ${task.time || ""}</p>` : ""}</div><button class="delete-todo p-1 ml-auto text-[var(--text-secondary)] hover:text-red-500"><i data-lucide="trash-2" class="h-4 w-4"></i></button></li>`;
                    }).join("");
                    lucide.createIcons();
                });
                
                form.onsubmit = async e => { e.preventDefault(); if (input.value.trim()) { await addDoc(tasksRef, { text: input.value.trim(), completed: false, date: dateInput.value, time: timeInput.value, createdAt: serverTimestamp() }); form.reset(); } };
                listEl.onclick = async e => { const id = e.target.closest("li")?.dataset.id; if (id) { const taskRef = doc(db, "users", currentUserId, "tasks", id); if (e.target.type === "checkbox") { const taskDoc = await getDoc(taskRef); await updateDoc(taskRef, { completed: !taskDoc.data().completed }); } else if (e.target.closest(".delete-todo")) { await deleteDoc(taskRef); } } };
                return () => { if (unsubscribeTasks) unsubscribeTasks(); };
            },
            calendar: (container) => {
                container.innerHTML = `<div class="text-center"><div class="flex justify-between items-center mb-4"><button id="c-prev" class="p-2 rounded-md hover:bg-[var(--bg-primary)]"><i data-lucide="chevron-left"></i></button><div class="flex gap-2"><select id="c-month" class="select-field"></select><select id="c-year" class="select-field"></select></div><button id="c-next" class="p-2 rounded-md hover:bg-[var(--bg-primary)]"><i data-lucide="chevron-right"></i></button></div><div id="c-grid" class="grid grid-cols-7 gap-1"></div></div>`;
                const monthSelect = document.getElementById("c-month"), yearSelect = document.getElementById("c-year"), grid = document.getElementById("c-grid"), prevBtn = document.getElementById("c-prev"), nextBtn = document.getElementById("c-next");
                let date = new Date();
                let markedDates = JSON.parse(localStorage.getItem("markedDates")) || {};
                const renderCalendar = () => {
                    date.setDate(1);
                    const month = date.getMonth(), year = date.getFullYear();
                    monthSelect.value = month; yearSelect.value = year;
                    const firstDayIndex = date.getDay(), lastDate = new Date(year, month + 1, 0).getDate(), prevLastDate = new Date(year, month, 0).getDate();
                    grid.innerHTML = ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"].map(d => `<div class="font-bold text-center text-[var(--text-secondary)] p-2">${d}</div>`).join("");
                    for (let i = firstDayIndex; i > 0; i--) grid.innerHTML += `<div class="text-center text-[var(--text-secondary)] p-2 opacity-50">${prevLastDate - i + 1}</div>`;
                    for (let i = 1; i <= lastDate; i++) {
                        const dateStr = `${year}-${month + 1}-${i}`;
                        const isToday = i === new Date().getDate() && month === new Date().getMonth() && year === new Date().getFullYear();
                        const isMarked = markedDates[dateStr];
                        grid.innerHTML += `<div data-date="${dateStr}" class="day text-center p-2 cursor-pointer rounded-full ${isToday ? "bg-blue-500 text-white" : ""} ${isMarked ? "border-2 border-red-500" : ""}">${i}</div>`;
                    }
                };
                const populateSelectors = () => {
                    for (let i = 0; i < 12; i++) monthSelect.innerHTML += `<option value="${i}">${new Date(0, i).toLocaleString("default", { month: "long" })}</option>`;
                    const currentYear = new Date().getFullYear();
                    for (let i = currentYear - 10; i <= currentYear + 10; i++) yearSelect.innerHTML += `<option value="${i}">${i}</option>`;
                };
                populateSelectors(); renderCalendar();
                prevBtn.onclick = () => { date.setMonth(date.getMonth() - 1); renderCalendar(); };
                nextBtn.onclick = () => { date.setMonth(date.getMonth() + 1); renderCalendar(); };
                monthSelect.onchange = () => { date.setMonth(monthSelect.value); renderCalendar(); };
                yearSelect.onchange = () => { date.setFullYear(yearSelect.value); renderCalendar(); };
                grid.onclick = e => { const dateStr = e.target.dataset.date; if (dateStr) { markedDates[dateStr] = !markedDates[dateStr]; localStorage.setItem("markedDates", JSON.stringify(markedDates)); renderCalendar(); } };
            },
            pomodoro: (container) => {
                container.innerHTML = `<div class="flex flex-col items-center text-center"><div class="flex gap-2 mb-4"><input type="number" id="p-work" class="input-field w-20" value="25" min="1"><input type="number" id="p-short" class="input-field w-20" value="5" min="1"><input type="number" id="p-long" class="input-field w-20" value="15" min="1"></div><div id="p-time" class="text-8xl font-bold mb-6">25:00</div><div class="flex space-x-4"><button id="p-start" class="btn-primary w-28 text-lg">START</button></div></div>`;
                let timerInterval, timeLeft, isRunning = false;
                const workInput = document.getElementById("p-work"), shortInput = document.getElementById("p-short"), longInput = document.getElementById("p-long"), timeDisplay = document.getElementById("p-time"), startBtn = document.getElementById("p-start");
                const updateDisplay = () => { const minutes = Math.floor(timeLeft / 60).toString().padStart(2, "0"), seconds = Math.floor(timeLeft % 60).toString().padStart(2, "0"); timeDisplay.textContent = `${minutes}:${seconds}`; };
                const resetTimer = () => { clearInterval(timerInterval); isRunning = false; startBtn.textContent = "START"; timeLeft = workInput.value * 60; updateDisplay(); };
                const startTimer = () => {
                    if (isRunning) { clearInterval(timerInterval); startBtn.textContent = "START"; } 
                    else { startBtn.textContent = "PAUSE"; if (window.Tone && Tone.context.state !== "running") Tone.start();
                        timerInterval = setInterval(() => { timeLeft--; updateDisplay(); if (timeLeft <= 0) { clearInterval(timerInterval); isRunning = false; startBtn.textContent = "START"; if(window.Tone) new Tone.Synth().toDestination().triggerAttackRelease("C5", "0.5"); } }, 1000);
                    }
                    isRunning = !isRunning;
                };
                startBtn.onclick = startTimer;
                workInput.onchange = resetTimer; shortInput.onchange = resetTimer; longInput.onchange = resetTimer;
                resetTimer();
            },
            unitConverter: (container) => {
                container.innerHTML = `<div class="space-y-4"><select id="u-type" class="select-field w-full"><option value="length">Length</option><option value="weight">Weight</option><option value="temp">Temperature</option></select><div class="flex items-center gap-4"><div class="w-1/2"><input type="number" id="u-input" class="input-field w-full" value="1"><select id="u-from" class="select-field w-full mt-2"></select></div><i data-lucide="arrow-right-left" class="h-6 w-6 text-[var(--text-secondary)]"></i><div class="w-1/2"><input type="text" id="u-output" readonly class="input-field w-full bg-[var(--bg-primary)]"><select id="u-to" class="select-field w-full mt-2"></select></div></div></div>`;
                const typeSelect = document.getElementById("u-type"), fromSelect = document.getElementById("u-from"), toSelect = document.getElementById("u-to"), input = document.getElementById("u-input"), output = document.getElementById("u-output");
                const units = { length: { 'Meters': 1, 'Kilometers': 1000, 'Miles': 1609.34, 'Feet': 0.3048 }, weight: { 'Grams': 1, 'Kilograms': 1000, 'Pounds': 453.592, 'Ounces': 28.3495 }, temp: { 'Celsius': 'c', 'Fahrenheit': 'f', 'Kelvin': 'k' } };
                
                const convert = () => {
                    const fromValue = parseFloat(input.value);
                    if (isNaN(fromValue)) return;
                    const type = typeSelect.value;
                    if (type === 'temp') {
                        let tempInCelsius;
                        if (fromSelect.value === 'c') tempInCelsius = fromValue;
                        else if (fromSelect.value === 'f') tempInCelsius = (fromValue - 32) * 5 / 9;
                        else if (fromSelect.value === 'k') tempInCelsius = fromValue - 273.15;
                        
                        if (toSelect.value === 'c') output.value = tempInCelsius.toFixed(2);
                        else if (toSelect.value === 'f') output.value = (tempInCelsius * 9 / 5 + 32).toFixed(2);
                        else if (toSelect.value === 'k') output.value = (tempInCelsius + 273.15).toFixed(2);
                    } else {
                        const fromUnit = parseFloat(fromSelect.value);
                        const toUnit = parseFloat(toSelect.value);
                        output.value = ((fromValue * fromUnit) / toUnit).toFixed(4);
                    }
                };
                
                const populateSelects = () => {
                    const type = typeSelect.value;
                    fromSelect.innerHTML = ''; toSelect.innerHTML = '';
                    Object.keys(units[type]).forEach(unit => {
                        fromSelect.innerHTML += `<option value="${units[type][unit]}">${unit}</option>`;
                        toSelect.innerHTML += `<option value="${units[type][unit]}">${unit}</option>`;
                    });
                    toSelect.selectedIndex = 1;
                    convert();
                };
                
                typeSelect.onchange = populateSelects; input.oninput = convert; fromSelect.onchange = convert; toSelect.onchange = convert;
                populateSelects();
            },
            qrCodeGenerator: (container) => {
                container.innerHTML = `<div class="space-y-4"><select id="qr-type" class="select-field w-full"><option value="qr">QR Code</option><option value="barcode">Barcode (CODE128)</option></select><input id="qr-input" type="text" class="input-field w-full" placeholder="Enter data..."><div class="flex items-center gap-2"><label>Logo:</label><input type="file" id="qr-logo" accept="image/*" class="input-field"></div><div id="qr-container" class="mx-auto my-4 p-2 bg-white inline-block"></div><button id="qr-gen" class="btn-primary w-full">Generate & Download</button></div>`;
                const typeSelect = document.getElementById("qr-type"), input = document.getElementById("qr-input"), logoInput = document.getElementById("qr-logo"), containerEl = document.getElementById("qr-container"), genBtn = document.getElementById("qr-gen");
                let logoImage = null;
                logoInput.onchange = e => { const file = e.target.files[0]; if (file) { const reader = new FileReader(); reader.onload = e => { logoImage = new Image(); logoImage.src = e.target.result; }; reader.readAsDataURL(file); } };
                genBtn.onclick = () => {
                    const data = input.value.trim(); if (!data) return;
                    containerEl.innerHTML = "";
                    if (typeSelect.value === 'qr') {
                        const qr = qrcode(0, 'H'); qr.addData(data); qr.make();
                        const canvas = document.createElement('canvas');
                        const size = 256;
                        canvas.width = size; canvas.height = size;
                        const ctx = canvas.getContext('2d');
                        const tileW = size / qr.getModuleCount();
                        const tileH = size / qr.getModuleCount();
                        for (let row = 0; row < qr.getModuleCount(); row++) {
                            for (let col = 0; col < qr.getModuleCount(); col++) {
                                ctx.fillStyle = qr.isDark(row, col) ? '#000' : '#fff';
                                ctx.fillRect(col * tileW, row * tileH, tileW, tileH);
                            }
                        }
                        if (logoImage) {
                            const logoSize = size / 4;
                            const logoX = (size - logoSize) / 2;
                            const logoY = (size - logoSize) / 2;
                            ctx.fillStyle = 'white';
                            ctx.fillRect(logoX - 2, logoY - 2, logoSize + 4, logoSize + 4);
                            ctx.drawImage(logoImage, logoX, logoY, logoSize, logoSize);
                        }
                        const link = document.createElement('a');
                        link.href = canvas.toDataURL("image/png");
                        link.download = "qrcode.png";
                        link.click();
                    } else if (typeSelect.value === 'barcode') {
                        containerEl.innerHTML = `<canvas id="barcode"></canvas>`;
                        JsBarcode("#barcode", data, { format: "CODE128" });
                        setTimeout(() => {
                            const canvas = document.getElementById("barcode");
                            const link = document.createElement("a");
                            link.href = canvas.toDataURL("image/png");
                            link.download = "barcode.png";
                            link.click();
                        }, 100);
                    }
                };
            },
            qrScanner: (container) => {
                container.innerHTML = `<div class="space-y-4"><input type="file" id="qs-upload" accept="image/*" class="input-field w-full"><canvas id="qs-canvas" class="hidden"></canvas><div id="qs-result" class="p-4 bg-[var(--bg-primary)] rounded-lg text-center">Upload an image to scan</div></div>`;
                const upload = document.getElementById("qs-upload"), canvas = document.getElementById("qs-canvas"), resultEl = document.getElementById("qs-result"), ctx = canvas.getContext("2d");
                upload.onchange = e => { const file = e.target.files[0]; if (file) { const reader = new FileReader(); reader.onload = e => { const img = new Image(); img.onload = () => { canvas.width = img.width; canvas.height = img.height; ctx.drawImage(img, 0, 0, img.width, img.height); const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height); const code = jsQR(imageData.data, imageData.width, imageData.height); resultEl.textContent = code ? `Result: ${code.data}` : "No QR/Barcode found."; }; img.src = e.target.result; }; reader.readAsDataURL(file); } };
            },
            compass: (container) => {
                container.innerHTML = `<div class="flex flex-col items-center justify-center"><div class="relative w-48 h-48"><div id="compass-dial" class="w-full h-full rounded-full flex items-center justify-center text-xl font-semibold" style="background-color: var(--bg-primary);"></div><div class="absolute top-0 left-1/2 -translate-x-1/2 -mt-2 text-red-500 text-2xl">▲</div><div class="absolute w-full h-full flex items-center justify-center text-center"><span class="absolute top-1">N</span><span class="absolute bottom-1">S</span><span class="absolute left-1">W</span><span class="absolute right-1">E</span></div></div><p id="compass-heading" class="mt-4 text-xl font-semibold">--°</p></div>`;
                const dial = document.getElementById("compass-dial"), headingEl = document.getElementById("compass-heading");
                const handler = e => { const heading = e.webkitCompassHeading || Math.abs(e.alpha - 360); dial.style.transform = `rotate(${-heading}deg)`; headingEl.textContent = `${Math.round(heading)}°`; };
                if (window.DeviceOrientationEvent && "requestPermission" in DeviceOrientationEvent) { DeviceOrientationEvent.requestPermission().then(res => { if (res === "granted") window.addEventListener("deviceorientation", handler); }); } 
                else if ('DeviceOrientationAbsoluteEvent' in window) { window.addEventListener("deviceorientationabsolute", handler, true); }
                else { container.innerHTML = `<p class="text-center text-red-500">Compass not supported on this device.</p>`; }
            },
            stepCounter: (container) => {
                container.innerHTML = `<div class="text-center space-y-4"><div class="text-6xl font-bold" id="sc-steps">0</div><p class="text-lg">Steps Today</p><div class="grid grid-cols-2 gap-4"><div class="p-4 bg-[var(--bg-primary)] rounded-lg"><p class="font-semibold">Distance</p><p id="sc-dist">0.00 km</p></div><div class="p-4 bg-[var(--bg-primary)] rounded-lg"><p class="font-semibold">Calories</p><p id="sc-cal">0 kcal</p></div></div><button id="sc-start" class="btn-primary">Start Tracking</button></div>`;
                const stepsEl = document.getElementById("sc-steps"), distEl = document.getElementById("sc-dist"), calEl = document.getElementById("sc-cal"), startBtn = document.getElementById("sc-start");
                startBtn.onclick = () => {
                    if ("Pedometer" in window) {
                        const pedometer = new Pedometer({ frequency: 1 });
                        pedometer.onreading = () => { stepsEl.textContent = pedometer.step; distEl.textContent = (pedometer.step * 0.000762).toFixed(2) + " km"; calEl.textContent = Math.round(pedometer.step * 0.04) + " kcal"; };
                        pedometer.start().catch(err => container.innerHTML = `<p class="text-center text-red-500">Could not start step counter: ${err.message}</p>`);
                        startBtn.textContent = "Tracking..."; startBtn.disabled = true;
                    } else { container.innerHTML = `<p class="text-center text-red-500">Step Counter not supported on this device.</p>`; }
                };
            },
            drawingBoard: (container) => {
                container.innerHTML = `<div class="space-y-4"><div class="flex flex-wrap gap-2 items-center"><label>Color:</label><input type="color" id="db-color" value="#000000" class="p-1 h-10 w-10 bg-transparent"><label class="ml-4">Size:</label><input type="range" id="db-size" min="1" max="50" value="5"><select id="db-brush" class="select-field"><option>Paint Brush</option><option>Round</option><option>Liner</option><option>Fan</option><option>Angled</option></select><button id="db-eraser" class="btn-secondary p-2"><i data-lucide="eraser"></i></button><button id="db-clear" class="btn-secondary p-2 ml-auto">Clear</button><button id="db-download" class="btn-primary p-2">Download</button></div><canvas id="db-canvas" class="rounded-lg bg-white" width="700" height="400"></canvas></div>`;
                const canvas = document.getElementById("db-canvas"), colorPicker = document.getElementById("db-color"), sizePicker = document.getElementById("db-size"), brushSelect = document.getElementById("db-brush"), eraserBtn = document.getElementById("db-eraser"), clearBtn = document.getElementById("db-clear"), downloadBtn = document.getElementById("db-download");
                const ctx = canvas.getContext("2d");
                let drawing = false, mode = "source-over";
                const startDraw = e => { drawing = true; draw(e); };
                const stopDraw = () => { drawing = false; ctx.beginPath(); };
                const draw = e => {
                    if (!drawing) return; e.preventDefault();
                    const rect = canvas.getBoundingClientRect();
                    const x = (e.clientX || e.touches[0].clientX) - rect.left;
                    const y = (e.clientY || e.touches[0].clientY) - rect.top;
                    ctx.lineWidth = sizePicker.value; ctx.lineCap = brushSelect.value === 'Round' ? 'round' : 'butt';
                    ctx.strokeStyle = colorPicker.value; ctx.globalCompositeOperation = mode;
                    ctx.lineTo(x, y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x, y);
                };
                clearBtn.onclick = () => ctx.clearRect(0, 0, canvas.width, canvas.height);
                eraserBtn.onclick = () => { mode = "destination-out"; };
                brushSelect.onchange = () => { mode = "source-over"; };
                colorPicker.onchange = () => { mode = "source-over"; };
                downloadBtn.onclick = () => { const link = document.createElement('a'); link.download = 'drawing.png'; link.href = canvas.toDataURL(); link.click(); };
                canvas.onmousedown = startDraw; canvas.onmouseup = stopDraw; canvas.onmousemove = draw;
                canvas.ontouchstart = startDraw; canvas.ontouchend = stopDraw; canvas.ontouchmove = draw;
            },
            imageEditor: (container) => {
                container.innerHTML = `<div class="space-y-4"><input type="file" id="ie-upload" accept="image/*" class="input-field w-full"><div id="image-editor-canvas-container" class="bg-[var(--bg-primary)] rounded-lg flex items-center justify-center"><canvas id="image-editor-canvas"></canvas><canvas id="image-editor-drawing-canvas"></canvas></div><div class="flex flex-wrap gap-2 items-center" id="ie-controls"></div></div>`;
                const upload = document.getElementById('ie-upload'), canvas = document.getElementById('image-editor-canvas'), drawingCanvas = document.getElementById('image-editor-drawing-canvas'), controls = document.getElementById('ie-controls');
                const ctx = canvas.getContext('2d'), drawCtx = drawingCanvas.getContext('2d');
                let originalImage = null, currentTool = 'none';

                const resizeCanvases = (img) => {
                    const container = canvas.parentElement;
                    const ratio = img.width / img.height;
                    let newW = container.clientWidth;
                    let newH = newW / ratio;
                    if (newH > container.clientHeight) { newH = container.clientHeight; newW = newH * ratio; }
                    canvas.width = drawingCanvas.width = newW;
                    canvas.height = drawingCanvas.height = newH;
                };
                
                upload.onchange = e => {
                    const file = e.target.files[0]; if (!file) return;
                    const reader = new FileReader();
                    reader.onload = event => {
                        originalImage = new Image();
                        originalImage.onload = () => { resizeCanvases(originalImage); ctx.filter = 'none'; drawCtx.clearRect(0,0,drawCtx.canvas.width, drawCtx.canvas.height); ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height); };
                        originalImage.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                };

                const tools = {
                    'Original': () => { if(!originalImage) return; ctx.filter = 'none'; ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height); },
                    'Draw': () => { currentTool = 'draw'; controls.innerHTML += `<input type="color" id="ie-draw-color" value="#ff0000"><input type="range" id="ie-draw-size" min="1" max="50" value="5">`; document.getElementById('ie-draw-color').onchange = e => drawCtx.strokeStyle = e.target.value; document.getElementById('ie-draw-size').oninput = e => drawCtx.lineWidth = e.target.value; },
                    'Blur Brush': () => { currentTool = 'blur'; controls.innerHTML += `<input type="range" id="ie-blur-intensity" min="1" max="20" value="5">`; },
                    'Remove BG': async () => {
                        if (!originalImage) return;
                        const btn = document.querySelector('[data-tool="Remove BG"]');
                        btn.textContent = 'Processing...'; btn.disabled = true;
                        try {
                            const formData = new FormData();
                            const blob = await (await fetch(originalImage.src)).blob();
                            formData.append('image_file', blob);
                            const response = await fetch('https://api.remove.bg/v1.0/removebg', {
                                method: 'POST',
                                headers: { 'X-Api-Key': 'eHXdmF47FTce3mcEEQUJqpU6' },
                                body: formData
                            });
                            if (!response.ok) throw new Error(`Error: ${response.statusText}`);
                            const resultBlob = await response.blob();
                            const url = URL.createObjectURL(resultBlob);
                            originalImage.src = url;
                        } catch (error) {
                            console.error("Background removal failed:", error);
                            alert("Background removal failed. Please check API key and credits.");
                        } finally {
                           btn.textContent = 'Remove BG'; btn.disabled = false;
                        }
                    },
                    'Download': () => {
                        const tempCanvas = document.createElement('canvas');
                        tempCanvas.width = canvas.width; tempCanvas.height = canvas.height;
                        const tempCtx = tempCanvas.getContext('2d');
                        tempCtx.drawImage(canvas, 0, 0);
                        tempCtx.drawImage(drawingCanvas, 0, 0);
                        const link = document.createElement('a');
                        link.download = 'edited-image.png';
                        link.href = tempCanvas.toDataURL();
                        link.click();
                    }
                };
                Object.keys(tools).forEach(name => { const btn = document.createElement('button'); btn.textContent = name; btn.className = 'btn-secondary text-sm'; btn.dataset.tool = name; btn.onclick = () => { controls.innerHTML = ''; Object.keys(tools).forEach(n => { const b = document.createElement('button'); b.textContent = n; b.className = 'btn-secondary text-sm'; b.dataset.tool = n; b.onclick = tools[n]; controls.appendChild(b); }); tools[name](); }; controls.appendChild(btn); });

                let drawing = false;
                const getPos = (e) => { const rect = drawingCanvas.getBoundingClientRect(); return { x: (e.clientX || e.touches[0].clientX) - rect.left, y: (e.clientY || e.touches[0].clientY) - rect.top }; };
                const start = e => { if(currentTool !== 'draw' && currentTool !== 'blur') return; drawing = true; draw(e); };
                const stop = () => { drawing = false; drawCtx.beginPath(); };
                const draw = e => {
                    if (!drawing) return; e.preventDefault();
                    const {x, y} = getPos(e);
                    if (currentTool === 'draw') { drawCtx.lineCap = 'round'; drawCtx.lineTo(x, y); drawCtx.stroke(); drawCtx.beginPath(); drawCtx.moveTo(x, y); }
                    if (currentTool === 'blur') {
                        const intensity = document.getElementById('ie-blur-intensity')?.value || 5;
                        const blurSize = 25;
                        const tempCanvas = document.createElement('canvas');
                        tempCanvas.width = canvas.width; tempCanvas.height = canvas.height;
                        const tempCtx = tempCanvas.getContext('2d');
                        tempCtx.filter = `blur(${intensity}px)`;
                        tempCtx.drawImage(canvas, 0, 0);
                        ctx.save();
                        ctx.beginPath();
                        ctx.arc(x, y, blurSize / 2, 0, Math.PI * 2);
                        ctx.clip();
                        ctx.drawImage(tempCanvas, 0, 0);
                        ctx.restore();
                    }
                };
                drawingCanvas.onmousedown = start; drawingCanvas.onmouseup = stop; drawingCanvas.onmousemove = draw;
                drawingCanvas.ontouchstart = start; drawingCanvas.ontouchend = stop; drawingCanvas.ontouchmove = draw;
            },
            passwordGenerator: (container) => {
                container.innerHTML = `<div class="space-y-6"><div class="relative"><input id="pg-output" type="text" readonly class="input-field w-full p-4 pr-12 text-lg font-mono" placeholder="Password..."><button id="pg-copy" class="absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-md hover:bg-[var(--bg-primary)]"><i data-lucide="copy" class="h-5 w-5"></i></button></div><div class="space-y-4"><div class="flex items-center justify-between"><label>Length</label><span id="pg-len-val" class="font-semibold w-12 text-center">16</span></div><input id="pg-len" type="range" min="8" max="64" value="16" class="w-full h-2 bg-[var(--bg-primary)] rounded-lg appearance-none cursor-pointer"></div><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><label class="flex items-center space-x-3 p-3 rounded-lg bg-[var(--bg-primary)]"><input type="checkbox" id="pg-upper" checked class="h-5 w-5 rounded text-[var(--accent-color)]"><span>Uppercase</span></label><label class="flex items-center space-x-3 p-3 rounded-lg bg-[var(--bg-primary)]"><input type="checkbox" id="pg-lower" checked class="h-5 w-5 rounded text-[var(--accent-color)]"><span>Lowercase</span></label><label class="flex items-center space-x-3 p-3 rounded-lg bg-[var(--bg-primary)]"><input type="checkbox" id="pg-num" checked class="h-5 w-5 rounded text-[var(--accent-color)]"><span>Numbers</span></label><label class="flex items-center space-x-3 p-3 rounded-lg bg-[var(--bg-primary)]"><input type="checkbox" id="pg-sym" checked class="h-5 w-5 rounded text-[var(--accent-color)]"><span>Symbols</span></label></div><button id="pg-gen" class="btn-primary w-full text-lg">Generate</button></div>`;
                const outputEl = document.getElementById("pg-output"), lengthEl = document.getElementById("pg-len"), lengthValueEl = document.getElementById("pg-len-val"), upperEl = document.getElementById("pg-upper"), lowerEl = document.getElementById("pg-lower"), numbersEl = document.getElementById("pg-num"), symbolsEl = document.getElementById("pg-sym"), generateBtn = document.getElementById("pg-gen"), copyBtn = document.getElementById("pg-copy");
                const charSets = { upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', lower: 'abcdefghijklmnopqrstuvwxyz', numbers: '0123456789', symbols: '!@#$%^&*()_+' };
                const generatePassword = () => {
                    const length = +lengthEl.value; let charset = '';
                    if (upperEl.checked) charset += charSets.upper;
                    if (lowerEl.checked) charset += charSets.lower;
                    if (numbersEl.checked) charset += charSets.numbers;
                    if (symbolsEl.checked) charset += charSets.symbols;
                    if (charset === '') { outputEl.value = 'Select at least one character set.'; return; }
                    let password = '';
                    for (let i = 0; i < length; i++) { password += charset.charAt(Math.floor(Math.random() * charset.length)); }
                    outputEl.value = password;
                };
                lengthEl.oninput = () => lengthValueEl.textContent = lengthEl.value;
                generateBtn.onclick = generatePassword;
                copyBtn.onclick = () => {
                    if (!outputEl.value || outputEl.value.startsWith('Select')) return;
                    const textarea = document.createElement('textarea');
                    textarea.value = outputEl.value; document.body.appendChild(textarea);
                    textarea.select();
                    try { document.execCommand('copy'); copyBtn.innerHTML = `<i data-lucide="check" class="h-5 w-5 text-green-500"></i>`; lucide.createIcons(); setTimeout(() => { copyBtn.innerHTML = `<i data-lucide="copy" class="h-5 w-5"></i>`; lucide.createIcons(); }, 2000); } catch (err) { console.error(err); }
                    document.body.removeChild(textarea);
                };
                generatePassword();
            },
            pdfConverter: (container) => {
                container.innerHTML = `<div class="space-y-4">
                    <h3 class="font-semibold">1. Select Conversion Type</h3>
                    <select id="pc-type" class="select-field w-full">
                        <optgroup label="Convert to PDF">
                            <option value="jpg-pdf">JPG to PDF</option>
                            <option value="word-pdf" disabled>Word to PDF (Coming Soon)</option>
                        </optgroup>
                        <optgroup label="Convert from PDF">
                            <option value="pdf-jpg">PDF to JPG</option>
                        </optgroup>
                    </select>
                    <h3 class="font-semibold">2. Upload File</h3>
                    <input type="file" id="pc-upload" class="input-field w-full" multiple>
                    <button id="pc-convert" class="btn-primary w-full">Convert & Download</button>
                    <p id="pc-status" class="text-center"></p>
                </div>`;
                
                const { PDFDocument } = window.PDFLib;
                const { jsPDF } = window.jspdf;

                document.getElementById('pc-convert').onclick = async () => {
                    const type = document.getElementById('pc-type').value;
                    const files = document.getElementById('pc-upload').files;
                    const status = document.getElementById('pc-status');
                    if (files.length === 0) { status.textContent = "Please select a file."; return; }
                    status.textContent = "Converting...";

                    if (type === 'jpg-pdf') {
                        const pdfDoc = await PDFDocument.create();
                        for (const file of files) {
                            const imgBytes = await file.arrayBuffer();
                            const img = await pdfDoc.embedJpg(imgBytes);
                            const page = pdfDoc.addPage([img.width, img.height]);
                            page.drawImage(img, { x: 0, y: 0, width: img.width, height: img.height });
                        }
                        const pdfBytes = await pdfDoc.save();
                        const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(blob);
                        link.download = 'converted.pdf';
                        link.click();
                        status.textContent = "Conversion complete!";
                    } else if (type === 'pdf-jpg') {
                        // This is more complex and requires a rendering library like pdf.js, simplified for now
                        status.textContent = "PDF to JPG conversion is a complex feature, coming soon!";
                    } else {
                        status.textContent = "This conversion type is not yet supported client-side.";
                    }
                };
            },
            currencyConverter: (container) => {
                container.innerHTML = `<div class="space-y-4"><div class="flex items-center gap-4"><div class="w-1/2"><input type="number" id="cc-input" class="input-field w-full" value="1"><select id="cc-from" class="select-field w-full mt-2"></select></div><i data-lucide="arrow-right-left" class="h-6 w-6 text-[var(--text-secondary)]"></i><div class="w-1/2"><div id="cc-output" class="p-2 h-10 flex items-center font-semibold text-lg">...</div><select id="cc-to" class="select-field w-full mt-2"></select></div></div><p id="cc-rate" class="text-sm text-center text-[var(--text-secondary)]"></p></div>`;
                const fromSelect = document.getElementById("cc-from"), toSelect = document.getElementById("cc-to"), input = document.getElementById("cc-input"), output = document.getElementById("cc-output"), rateEl = document.getElementById("cc-rate");
                let rates = {};
                const convert = () => { if (!rates) return; const from = fromSelect.value, to = toSelect.value, amount = parseFloat(input.value); if (isNaN(amount)) return; const rate = rates[to] / rates[from]; output.textContent = (amount * rate).toFixed(2); rateEl.textContent = `1 ${from} = ${rate.toFixed(4)} ${to}`; };
                fetch("https://api.exchangerate-api.com/v4/latest/USD").then(res => res.json()).then(data => { rates = data.rates; Object.keys(rates).forEach(currency => { fromSelect.innerHTML += `<option value="${currency}">${currency}</option>`; toSelect.innerHTML += `<option value="${currency}">${currency}</option>`; }); fromSelect.value = "USD"; toSelect.value = "EUR"; convert(); }).catch(err => container.innerHTML = `<p class="text-center text-red-500">Could not load currency data.</p>`);
                [input, fromSelect, toSelect].forEach(el => el.oninput = convert);
            },
            translator: (container) => {
                container.innerHTML = `<div class="space-y-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><select id="tl-from" class="select-field w-full mb-2"></select><textarea id="tl-from-text" class="input-field w-full h-32" placeholder="Enter text..."></textarea></div><div><select id="tl-to" class="select-field w-full mb-2"></select><textarea id="tl-to-text" readonly class="input-field w-full h-32 bg-[var(--bg-primary)]" placeholder="Translation..."></textarea></div></div><button id="tl-btn" class="btn-primary w-full">Translate</button></div>`;
                const fromLang = document.getElementById("tl-from"), toLang = document.getElementById("tl-to"), fromText = document.getElementById("tl-from-text"), toText = document.getElementById("tl-to-text"), translateBtn = document.getElementById("tl-btn");
                const languages = { 'English': 'en', 'Spanish': 'es', 'French': 'fr', 'German': 'de', 'Japanese': 'ja', 'Russian': 'ru', 'Chinese': 'zh', 'Bengali': 'bn', 'Hindi': 'hi', 'Arabic': 'ar' };
                Object.keys(languages).forEach(lang => { fromLang.innerHTML += `<option value="${languages[lang]}">${lang}</option>`; toLang.innerHTML += `<option value="${languages[lang]}">${lang}</option>`; });
                toLang.value = 'bn';
                translateBtn.onclick = () => { const text = fromText.value.trim(); if (!text) return; toText.value = "Translating..."; fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${fromLang.value}|${toLang.value}`).then(res => res.json()).then(data => { toText.value = data.responseData.translatedText; }).catch(err => { toText.value = "Translation failed."; }); };
            }
        };

        // --- DASHBOARD RENDERING & FILTERING ---
        const featuresGrid = document.getElementById('features-grid'), searchInput = document.getElementById('search-input'), filterButtonsContainer = document.getElementById('filter-buttons'), noResultsMessage = document.getElementById('no-results');
        const renderFeatures = (filteredFeatures) => {
            featuresGrid.innerHTML = ''; noResultsMessage.classList.toggle('hidden', filteredFeatures.length > 0);
            filteredFeatures.forEach(feature => {
                const card = document.createElement('div');
                card.className = 'card rounded-lg p-5 flex flex-col items-center text-center cursor-pointer transition-all duration-200'; card.dataset.appId = feature.id;
                card.innerHTML = `<div class="mb-4 text-[var(--accent-color)]"><i data-lucide="${feature.icon}" class="h-10 w-10"></i></div><h3 class="font-semibold text-lg mb-1">${feature.name}</h3><p class="text-sm text-[var(--text-secondary)] flex-grow">${feature.description}</p>`;
                featuresGrid.appendChild(card);
            });
            lucide.createIcons();
        };
        const renderFilterButtons = () => {
            const categories = ['All', ...new Set(features.map(f => f.category))];
            filterButtonsContainer.innerHTML = '';
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'filter-btn px-3 py-1.5 text-sm font-medium rounded-md transition'; button.textContent = category; button.dataset.category = category;
                if (category === 'All') button.classList.add('active');
                filterButtonsContainer.appendChild(button);
            });
        };
        const filterAndSearch = () => {
            const searchTerm = searchInput.value.toLowerCase(), activeFilter = document.querySelector('.filter-btn.active').dataset.category;
            const filteredFeatures = features.filter(feature => (activeFilter === 'All' || feature.category === activeFilter) && (feature.name.toLowerCase().includes(searchTerm) || feature.description.toLowerCase().includes(searchTerm)));
            renderFeatures(filteredFeatures);
        };
        searchInput.oninput = filterAndSearch;
        filterButtonsContainer.onclick = (e) => { if (e.target.tagName === 'BUTTON') { document.querySelector('.filter-btn.active').classList.remove('active'); e.target.classList.add('active'); filterAndSearch(); } };
        featuresGrid.onclick = (e) => { const card = e.target.closest('.card'); if (card) { const appId = card.dataset.appId; const feature = features.find(f => f.id === appId); if (feature) openApp(feature); } };

        // --- INITIALIZATION ---
        const features = [ { id: 'notepad', name: 'Notepad', category: 'Productivity', icon: 'notebook-pen', description: 'Jot down notes.' }, { id: 'todo', name: 'To-Do List', category: 'Productivity', icon: 'list-checks', description: 'Organize your tasks.' }, { id: 'calendar', name: 'Calendar', category: 'Productivity', icon: 'calendar-days', description: 'View the calendar.' }, { id: 'pomodoro', name: 'Pomodoro Timer', category: 'Productivity', icon: 'timer', description: 'Boost your focus.' }, { id: 'unitConverter', name: 'Unit Converter', category: 'Productivity', icon: 'ruler', description: 'Convert measurements.' }, { id: 'currencyConverter', name: 'Currency Converter', category: 'Productivity', icon: 'dollar-sign', description: 'Real-time exchange rates.' }, { id: 'translator', name: 'Translator', category: 'Productivity', icon: 'languages', description: 'Translate any language.' }, { id: 'pdfConverter', name: 'PDF/JPG Converter', category: 'Utility', icon: 'file-cog', description: 'Convert document formats.' }, { id: 'qrCodeGenerator', name: 'QR/Barcode Generator', category: 'Utility', icon: 'qr-code', description: 'Create codes.' }, { id: 'qrScanner', name: 'QR/Barcode Scanner', category: 'Utility', icon: 'scan-line', description: 'Scan codes from images.' }, { id: 'imageEditor', name: 'Image Editor', category: 'Media', icon: 'image', description: 'Edit your images.' }, { id: 'drawingBoard', name: 'Drawing Board', category: 'Media', icon: 'pencil-ruler', description: 'Unleash creativity.' }, { id: 'passwordGenerator', name: 'Password Generator', category: 'Utility', icon: 'key-round', description: 'Generate passwords.' }, { id: 'compass', name: 'Compass', category: 'Utility', icon: 'compass', description: 'Find your direction.' }, { id: 'stepCounter', name: 'Step Counter', category: 'Health', icon: 'footprints', description: 'Track your daily steps.' }, ];
        
        renderFilterButtons();
        filterAndSearch();
        lucide.createIcons();
    </script>
</body>
</html>
